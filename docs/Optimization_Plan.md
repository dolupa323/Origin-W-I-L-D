# WildForge 개발 최적화 계획서 (Optimization Plan)

본 문서는 'WildForge'의 동시 접속자 수(CCU) 확장을 위한 서버 및 클라이언트 최적화 방안을 정리합니다. 현재 시스템은 소규모(20-30명)에는 적합하나, 50명 이상의 대규모 플레이 환경을 위해 다음과 같은 개선이 필요합니다.

## 1. 서버 AI 최적화 (CreatureService)

### 1.1 최적화 필요성
- 현재 300마리의 크리처가 0.3초마다 모든 플레이어와의 거리를 체크하여 연산량이 $O(C \times P)$로 증가함.
- 서버 FPS(Heartbeat) 저하의 가장 큰 원인.

### 1.2 개선 대책
- **공간 분할 감지**: 플레이어 근처의 크리처만 활성화하거나, `CollectionService`를 활용해 특정 범위 내 플레이어만 검색.
- **AI LOD (Level of Detail)**:
    - 플레이어와 100스터드 이내: 0.3초 주기 업데이트.
    - 100~300스터드: 1.0초 주기 업데이트.
    - 300스터드 이상: 3.0초 주기 업데이트 및 물리 연산 최소화.
- **연산 분산**: 모든 크리처를 한 프레임에 처리하지 않고, 프레임별로 할당량을 나누어 처리 (Task Scheduler).

## 2. 네트워크 대역폭 최적화 (NetController & Services)

### 2.1 최적화 필요성
- `FireAllClients` 남용으로 인해 맵 반대편의 불필요한 이벤트(드롭 아이템 생성, 자원 고갈 등) 정보가 모든 클라이언트에 전송됨.
- 접속자가 많아질수록 핑(Ping) 상승 및 클라이언트 부하 증가.

### 2.2 개선 대책
- **Proximity-based Broadcasting**: 
    - `NetController`에 `FireClientsInRange(position, distance, event, data)` 함수 추가.
    - 드롭 아이템 생성, 크리처 상태 변화 등은 근처 플레이어에게만 전송.
- **데이터 패킷 압축**: 전송하는 테이블의 키값을 짧게 줄이거나, Enum을 활용해 데이터 크기 최소화.

## 3. 엔티티 및 물리 최적화

### 3.1 개선 대책
- **자원 노드 가상화**: 매우 멀리 있는 자원 노드는 클라이언트에서 렌더링하지 않고, 가까워질 때만 생성 (StreamingEnabled 연동 또는 커스텀 거리 렌더링).
- **Collision Group 설정**: 크리처끼리의 충돌 연산을 비활성화하거나 간소화하여 서버 물리 물리 연산 부하 경감.

---

## 작업 우선순위 (Implementation Roadmap)

1.  **Phase 1 (긴급)**: `CreatureService` AI LOD 적용 및 플레이어 감지 로직 개선.
2.  **Phase 2 (중요)**: `NetController` 거리 기반 이벤트 전송 시스템 구축.
3.  **Phase 3 (보통)**: 엔티티 관리 효율화 및 물리 충돌 그룹 정리.
